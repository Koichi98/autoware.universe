<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <arg name="input/detection01/objects" default="input/objects01"/>
  <arg name="input/detection01/channel" default="none"/>
  <arg name="input/detection02/objects" default="input/objects02"/>
  <arg name="input/detection02/channel" default="none"/>
  <arg name="input/detection03/objects" default="input/objects03"/>
  <arg name="input/detection03/channel" default="none"/>
  <arg name="input/detection04/objects" default="input/objects04"/>
  <arg name="input/detection04/channel" default="none"/>
  <arg name="input/detection05/objects" default="input/objects05"/>
  <arg name="input/detection05/channel" default="none"/>
  <arg name="input/detection06/objects" default="input/objects06"/>
  <arg name="input/detection06/channel" default="none"/>
  <arg name="input/detection07/objects" default="input/objects07"/>
  <arg name="input/detection07/channel" default="none"/>
  <arg name="input/detection08/objects" default="input/objects08"/>
  <arg name="input/detection08/channel" default="none"/>
  <arg name="input/detection09/objects" default="input/objects09"/>
  <arg name="input/detection09/channel" default="none"/>
  <arg name="input/detection10/objects" default="input/objects10"/>
  <arg name="input/detection10/channel" default="none"/>
  <arg name="input/detection11/objects" default="input/objects11"/>
  <arg name="input/detection11/channel" default="none"/>
  <arg name="input/detection12/objects" default="input/objects12"/>
  <arg name="input/detection12/channel" default="none"/>
  <arg name="output/objects" default="objects"/>
  <arg name="tracker_setting_path" default="$(find-pkg-share autoware_multi_object_tracker)/config/multi_object_tracker_node.param.yaml"/>
  <arg name="data_association_matrix_path" default="$(find-pkg-share autoware_multi_object_tracker)/config/data_association_matrix.param.yaml"/>
  <arg name="input_channels_path" default="$(find-pkg-share autoware_multi_object_tracker)/config/input_channels.param.yaml"/>

  <!-- Agnocast -->
  <arg name="use_agnocast" default="false" description="enable Agnocast for planning containers"/>
  <arg name="agnocast_heaphook_path" description="path to agnocast heaphook library"/>

  <!-- Container configuration based on use_agnocast -->
  <let name="container_pkg" value="agnocastlib" if="$(var use_agnocast)"/>
  <let name="container_pkg" value="rclcpp_components" unless="$(var use_agnocast)"/>
  <let name="container_exec" value="agnocast_component_container" if="$(var use_agnocast)"/>
  <let name="container_exec" value="component_container" unless="$(var use_agnocast)"/>

  <!-- Environment variable values based on use_agnocast -->
  <let name="ld_preload_value" value="$(var agnocast_heaphook_path):$(env LD_PRELOAD '')" if="$(var use_agnocast)"/>
  <let name="ld_preload_value" value="$(env LD_PRELOAD '')" unless="$(var use_agnocast)"/>
  <let name="mempool_size" value="8589934592" if="$(var use_agnocast)"/>
  <let name="mempool_size" value="0" unless="$(var use_agnocast)"/>

  <node_container pkg="$(var container_pkg)" exec="$(var container_exec)" name="multi_object_tracker_container" namespace="" output="both">
    <env name="LD_PRELOAD" value="$(var ld_preload_value)"/>
    <env name="AGNOCAST_MEMPOOL_SIZE" value="$(var mempool_size)"/>

    <composable_node pkg="autoware_multi_object_tracker" plugin="autoware::multi_object_tracker::MultiObjectTracker" name="multi_object_tracker" namespace="">
      <param name="input/detection01/objects" value="$(var input/detection01/objects)"/>
      <param name="input/detection01/channel" value="$(var input/detection01/channel)"/>
      <param name="input/detection02/objects" value="$(var input/detection02/objects)"/>
      <param name="input/detection02/channel" value="$(var input/detection02/channel)"/>
      <param name="input/detection03/objects" value="$(var input/detection03/objects)"/>
      <param name="input/detection03/channel" value="$(var input/detection03/channel)"/>
      <param name="input/detection04/objects" value="$(var input/detection04/objects)"/>
      <param name="input/detection04/channel" value="$(var input/detection04/channel)"/>
      <param name="input/detection05/objects" value="$(var input/detection05/objects)"/>
      <param name="input/detection05/channel" value="$(var input/detection05/channel)"/>
      <param name="input/detection06/objects" value="$(var input/detection06/objects)"/>
      <param name="input/detection06/channel" value="$(var input/detection06/channel)"/>
      <param name="input/detection07/objects" value="$(var input/detection07/objects)"/>
      <param name="input/detection07/channel" value="$(var input/detection07/channel)"/>
      <param name="input/detection08/objects" value="$(var input/detection08/objects)"/>
      <param name="input/detection08/channel" value="$(var input/detection08/channel)"/>
      <param name="input/detection09/objects" value="$(var input/detection09/objects)"/>
      <param name="input/detection09/channel" value="$(var input/detection09/channel)"/>
      <param name="input/detection10/objects" value="$(var input/detection10/objects)"/>
      <param name="input/detection10/channel" value="$(var input/detection10/channel)"/>
      <param name="input/detection11/objects" value="$(var input/detection11/objects)"/>
      <param name="input/detection11/channel" value="$(var input/detection11/channel)"/>
      <param name="input/detection12/objects" value="$(var input/detection12/objects)"/>
      <param name="input/detection12/channel" value="$(var input/detection12/channel)"/>
      <remap from="output/objects" to="$(var output/objects)"/>
      <param from="$(var tracker_setting_path)"/>
      <param from="$(var data_association_matrix_path)"/>
      <param from="$(var input_channels_path)"/>
    </composable_node>
  </node_container>
</launch>
